<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>how can i</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* SVG-specific styles (keep for diagram colors) */
    .svg-label {
      font-size: 1.05rem;
      fill: #3b82f6;
      font-family: 'Segoe UI', Arial, sans-serif;
      text-anchor: middle;
      dominant-baseline: middle;
      pointer-events: none;
    }
    .svg-ohm {
      font-size: 0.95rem;
      fill: #64748b;
      font-family: 'Segoe UI', Arial, sans-serif;
      text-anchor: middle;
      dominant-baseline: middle;
      pointer-events: none;
    }
    .svg-volt {
      font-size: 0.95rem;
      fill: #f59e42;
      font-family: 'Segoe UI', Arial, sans-serif;
      text-anchor: middle;
      dominant-baseline: middle;
      pointer-events: none;
    }
    .svg-resistor {
      fill: #e0f2fe;
      stroke: #3b82f6;
      stroke-width: 2;
      rx: 5;
    }
    .svg-resistor-parallel {
      fill: #dcfce7;
      stroke: #22c55e;
      stroke-width: 2;
      rx: 5;
    }
    .svg-wire {
      stroke: #222;
      stroke-width: 2.5;
    }
    .svg-branch-wire {
      stroke: #22c55e;
      stroke-width: 2.2;
    }
    /* Add new styles for results formatting */
    .calculations-container {
      font-family: system-ui, -apple-system, sans-serif;
      padding: 20px;
      max-width: 600px;
      margin: 20px auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .calculations-container h2 {
      font-size: 20px;
      margin: 0 0 20px 0;
      color: #1a1a1a;
    }

    .voltage-input-group {
      background: #fff;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 10px;
    }

    .input-fields {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
    }

    .input-group {
      flex: 1;
    }

    .calculate-btn {
      background: #2563eb;
      color: white;
      border: none;
      padding: 0.75rem 2rem;
      border-radius: 0.5rem;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      width: 100%;
      margin: 1rem 0;
    }

    .calculate-btn:hover {
      background: #1d4ed8;
    }

    #resultsSection {
      display: none;
      background-color: #1e3a8a; /* Dark blue background */
      color: white;
      padding: 1.5rem;
      border-radius: 0.75rem;
      margin-top: 1.5rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }

    .total-circuit {
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      padding-bottom: 1.25rem;
      margin-bottom: 1.25rem;
    }

    .total-circuit h3 {
      font-size: 1.25rem;
      margin: 0 0 1rem 0;
      font-weight: 600;
      color: white;
    }

    .circuit-values {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .circuit-value-label {
      font-size: 0.875rem;
      color: rgba(255, 255, 255, 0.9);
    }

    .circuit-value-number {
      font-size: 1.5rem;
      font-weight: 600;
      color: white;
    }

    .series-analysis {
      margin-top: 1.25rem;
    }

    .series-analysis h3 {
      font-size: 1.25rem;
      margin: 0 0 1rem 0;
      color: white;
      font-weight: 600;
    }

    .series-group {
      border-left: 4px solid rgba(255, 255, 255, 0.3);
      padding: 1rem;
      margin-bottom: 1rem;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 0 0.5rem 0.5rem 0;
    }

    .series-group-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
    }

    .series-group-title {
      font-size: 1rem;
      color: white;
      font-weight: 500;
    }

    .parallel-count {
      font-size: 0.875rem;
      color: rgba(255, 255, 255, 0.9);
    }

    .series-group-values {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.25rem;
    }

    .series-value {
      font-size: 0.875rem;
    }

    .series-value-label {
      color: rgba(255, 255, 255, 0.8);
      margin-bottom: 0.25rem;
    }

    .series-value-number {
      color: white;
      font-size: 1rem;
      font-weight: 500;
    }
  </style>
</head>
<body>
  <div class="min-h-screen bg-blue-50 py-8 px-2">
    <h1 class="text-4xl font-bold text-center text-blue-700 mb-2 tracking-tight">Resistor Calculator</h1>
    <div class="w-full mb-6">
      <div class="bg-white shadow-sm text-gray-700">
        <div class="max-w-7xl mx-auto px-6 py-5">
          <div class="flex items-start gap-3">
            <p class="text-lg leading-relaxed flex-1">
              Enter the resistance values for each resistor in your circuit. You can add resistors in series or in parallel, just like you would build a real circuit.
              Next, enter either the total voltage (V) supplied to the circuit or the total current (I) flowing through it.
              The calculator will work out the total resistance and show you a breakdown of voltage drops and currents.
            </p>
            <div class="relative group">
              <button class="w-8 h-8 flex items-center justify-center rounded-full bg-blue-100 text-blue-700 hover:bg-blue-200">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z" />
                </svg>
              </button>
              <div class="absolute right-0 w-80 p-4 bg-blue-50 rounded-lg shadow-lg text-blue-700 invisible opacity-0 group-hover:visible group-hover:opacity-100 transition-all duration-200 z-10">
                <strong class="block mb-2">Tip:</strong>
                <p class="text-sm">
                  If you only know the resistance values and the voltage, the calculator will find the current. If you know the resistance and the current, it will work out the voltage. Use this tool to check your own calculations and see how series and parallel connections affect the circuit!
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="flex flex-col lg:flex-row gap-8 w-full mx-auto">
      <!-- Left Column: Diagram + Resistor Panel -->
      <div class="flex-[2] min-w-[350px] w-full flex flex-col gap-6">
        <div class="bg-white rounded-2xl shadow-lg p-6 w-full flex flex-col">
        <div class="flex items-center justify-between mb-4">
          <span class="text-xl font-semibold text-gray-800">Circuit Diagram</span>
        </div>
        <div class="flex-1 flex items-center justify-center">
          <div class="w-full bg-blue-50 rounded-xl p-2 flex items-center justify-center min-h-[350px]">
            <div class="w-full" id="diagramArea"></div>
          </div>
        </div>
        </div>
        <div class="bg-white rounded-2xl shadow-lg p-6 w-full flex flex-col">
          <div class="flex justify-between items-center mb-4">
            <div class="text-xl font-semibold text-gray-800">Resistors</div>
            <button onclick="addSeriesResistor()" class="px-3 py-1.5 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors">
              + Add Series
            </button>
          </div>
          <div id="resistorSidebar" class="flex flex-col gap-4">
            <!-- Resistor inputs will be dynamically added here -->
          </div>
        </div>
      </div>
      <!-- Right Column: Calculation Panel -->
      <div class="bg-white rounded-2xl shadow-lg p-10 flex-[1] w-full flex flex-col">
        <div class="calculations-container w-full max-w-none m-0">
          <h2>Calculations</h2>
          
          <div class="input-fields">
            <div class="input-group">
              <label for="totalVoltageInput">Total Voltage (V)</label>
              <input type="number" id="totalVoltageInput" class="voltage-input" placeholder="Enter voltage">
            </div>
            <div class="input-group">
              <label for="totalCurrentInput">Total Current (A)</label>
              <input type="number" id="totalCurrentInput" class="voltage-input" placeholder="Enter current">
            </div>
          </div>

          <div class="flex gap-4">
            <button class="calculate-btn flex-1" onclick="calculateAndDisplay()">Calculate</button>
            <button class="px-6 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors" onclick="resetCalculator()">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
              </svg>
            </button>
          </div>

          <div id="resultsSection">
            <div class="total-circuit">
              <h3>Total Circuit</h3>
              <div class="circuit-values">
                <div>
                  <div class="circuit-value-label">Total Resistance</div>
                  <div class="circuit-value-number"><span id="totalResistance">0</span> Ω</div>
                </div>
                <div>
                  <div class="circuit-value-label">Total Current</div>
                  <div class="circuit-value-number"><span id="totalCurrent">0</span> A</div>
                </div>
              </div>
            </div>

            <div class="series-analysis">
              <h3>Step-by-Step Analysis</h3>
              <div id="seriesGroups">
                <!-- Series groups will be populated here -->
                <!-- Series groups will be populated dynamically by JavaScript -->
              </div>
            </div>
          </div>
        </div>
        <div class="results" id="resultsArea" style="display:none;">
          <div class="total-resistance text-2xl font-bold text-center mb-4" id="totalResistance"></div>
          <div class="resistor-details flex flex-col gap-2 items-center mb-4" id="resistorDetails"></div>
          <div class="working-steps bg-blue-50 rounded-lg p-4 text-base text-gray-800 shadow-inner overflow-x-auto" id="workingSteps"></div>
        </div>
      </div>
    </div>
  </div>
  <script>
    // --- Data Model ---
    // Each series resistor is an object: { value, parallels: [ { value }, ... ] }
    let resistors = [
      { value: 10, parallels: [] },
      { value: 10, parallels: [] }
    ];

    // --- Utility Functions ---
    function isValidNumber(val) {
      return typeof val === 'number' && !isNaN(val) && val > 0;
    }

    // --- DOM Elements ---
    const diagramArea = document.getElementById('diagramArea');
    const totalVoltageInput = document.getElementById('totalVoltageInput');
    const totalCurrentInput = document.getElementById('totalCurrentInput');
    const totalResistanceDiv = document.getElementById('totalResistance');
    const resistorDetailsDiv = document.getElementById('resistorDetails');
    const resistorSidebar = document.getElementById('resistorSidebar');
    const resultsArea = document.getElementById('resultsArea');
    const workingStepsDiv = document.getElementById('workingSteps');

    // Store last breakdown for diagram annotation
    let lastBreakdown = null;

    // --- Diagram Rendering ---
    function renderDiagram() {
      // --- SVG Schematic Layout ---
      diagramArea.innerHTML = '';
      
      // Adjust width calculation to ensure enough space for all components
      const minWidth = 800; // Increased minimum width
      const componentWidth = 200; // Increased width per component
      const width = Math.max(minWidth, componentWidth * resistors.length + 300); // Added more padding
      
      // Calculate max number of parallel branches for height
      let maxPar = Math.max(1, ...resistors.map(r => r.parallels.length + 1));
      const parSpacing = 60; // Reduced parallel spacing
      const minHeight = 400; // Increased minimum height
      const height = Math.max(minHeight, 2 * ((maxPar - 1) / 2) * parSpacing + 300); // Increased vertical space
      
      const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
      svg.setAttribute('viewBox', `0 0 ${width} ${height}`);
      svg.setAttribute('width', '100%');
      svg.setAttribute('height', height);
      svg.classList.add('svg-circuit');
      
      // Define block dimensions
      const blockW = 60;
      const blockH = 28;
      const gap = 140; // Increased gap between components
      
      // Main wire coordinates - adjust vertical position to center better
      const yMain = height / 2; // Centered main wire
      const xStart = 100; // Increased left margin
      const xEnd = width - 100; // Increased right margin
      const batteryHeight = 40;
      const batteryX = xStart + (xEnd - xStart) / 2;

      // Compute x positions for components with more spacing
      let xPositions = [];
      let xPos = xStart + 80; // Increased initial offset
      for (let i = 0; i < resistors.length; i++) {
        if (i > 0) {
          xPos += gap;
        }
        xPositions.push(xPos);
        let blockWidth = resistors[i].parallels.length > 0 ? 160 : blockW; // Increased parallel block width
        xPos += blockWidth;
      }

      let dotsToAdd = []; // Store dots to draw later

      // Draw vertical wires at start and end
      const leftVerticalWire = document.createElementNS('http://www.w3.org/2000/svg', 'line');
      leftVerticalWire.setAttribute('x1', xStart);
      leftVerticalWire.setAttribute('y1', yMain);
      leftVerticalWire.setAttribute('x2', xStart);
      leftVerticalWire.setAttribute('y2', yMain + 110);
      leftVerticalWire.setAttribute('class', 'svg-wire');
      svg.appendChild(leftVerticalWire);

      // Bottom wire (left part)
      const bottomWire1 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
      bottomWire1.setAttribute('x1', xStart);
      bottomWire1.setAttribute('y1', yMain + 110);
      bottomWire1.setAttribute('x2', batteryX - 20);
      bottomWire1.setAttribute('y2', yMain + 110);
      bottomWire1.setAttribute('class', 'svg-wire');
      svg.appendChild(bottomWire1);

      // Draw main horizontal wire in segments
      let prevX = xStart;
      for (let i = 0; i < resistors.length; i++) {
        const x = xPositions[i];
        const isParallel = resistors[i].parallels.length > 0;
        const blockWidth = isParallel ? 160 : blockW;
        const resistorX = x + 10;
        
        // Wire segment before component
        const wireLeft = document.createElementNS('http://www.w3.org/2000/svg', 'line');
        wireLeft.setAttribute('x1', prevX);
        wireLeft.setAttribute('y1', yMain);
        wireLeft.setAttribute('x2', resistorX);
        wireLeft.setAttribute('y2', yMain);
        wireLeft.setAttribute('class', 'svg-wire');
        svg.appendChild(wireLeft);
        
        // Update prevX for next segment
        prevX = resistorX + blockWidth;
      }
      
      // Calculate the actual end point based on the last resistor
      const lastResistor = resistors[resistors.length - 1];
      const lastX = xPositions[resistors.length - 1];
      const lastBlockWidth = lastResistor.parallels.length > 0 ? 160 : blockW;
      const lastResistorX = lastX + 10;
      const actualEndX = lastResistorX + lastBlockWidth;
      
      // Add final horizontal wire segment that matches initial gap
      const finalWire = document.createElementNS('http://www.w3.org/2000/svg', 'line');
      finalWire.setAttribute('x1', actualEndX);
      finalWire.setAttribute('y1', yMain);
      finalWire.setAttribute('x2', actualEndX + gap/2);
      finalWire.setAttribute('y2', yMain);
      finalWire.setAttribute('class', 'svg-wire');
      svg.appendChild(finalWire);

      // Right vertical wire (moved to new end point)
      const rightVerticalWire = document.createElementNS('http://www.w3.org/2000/svg', 'line');
      rightVerticalWire.setAttribute('x1', actualEndX + gap/2);
      rightVerticalWire.setAttribute('y1', yMain);
      rightVerticalWire.setAttribute('x2', actualEndX + gap/2);
      rightVerticalWire.setAttribute('y2', yMain + 110);
      rightVerticalWire.setAttribute('class', 'svg-wire');
      svg.appendChild(rightVerticalWire);

      // Bottom wire (right part, extended to new end point)
      const bottomWire2 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
      bottomWire2.setAttribute('x1', batteryX + 20);
      bottomWire2.setAttribute('y1', yMain + 110);
      bottomWire2.setAttribute('x2', actualEndX + gap/2);
      bottomWire2.setAttribute('y2', yMain + 110);
      bottomWire2.setAttribute('class', 'svg-wire');
      svg.appendChild(bottomWire2);

      // Battery symbol (rotated 90 degrees)
      // Longer vertical line
      const batteryLong = document.createElementNS('http://www.w3.org/2000/svg', 'line');
      batteryLong.setAttribute('x1', batteryX);
      batteryLong.setAttribute('y1', yMain + 90);
      batteryLong.setAttribute('x2', batteryX);
      batteryLong.setAttribute('y2', yMain + 130);
      batteryLong.setAttribute('class', 'svg-wire');
      batteryLong.setAttribute('stroke-width', '3');
      svg.appendChild(batteryLong);

      // Shorter vertical line
      const batteryShort = document.createElementNS('http://www.w3.org/2000/svg', 'line');
      batteryShort.setAttribute('x1', batteryX - 10);
      batteryShort.setAttribute('y1', yMain + 100);
      batteryShort.setAttribute('x2', batteryX - 10);
      batteryShort.setAttribute('y2', yMain + 120);
      batteryShort.setAttribute('class', 'svg-wire');
      batteryShort.setAttribute('stroke-width', '3');
      svg.appendChild(batteryShort);

      // Voltage or Current label
      const currentValue = totalCurrentInput.value.trim();
      const voltageValue = totalVoltageInput.value.trim();
      
      if (currentValue) {
        // Show current on left side
        const currentLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
        currentLabel.setAttribute('x', xStart - 15);
        currentLabel.setAttribute('y', yMain + 20);
        currentLabel.setAttribute('class', 'svg-volt');
        currentLabel.setAttribute('text-anchor', 'end');
        currentLabel.textContent = currentValue + ' A';
        svg.appendChild(currentLabel);
        
        // Add arrow for current direction
        const arrowMarker = document.createElementNS('http://www.w3.org/2000/svg', 'marker');
        arrowMarker.setAttribute('id', 'arrowhead');
        arrowMarker.setAttribute('markerWidth', '10');
        arrowMarker.setAttribute('markerHeight', '7');
        arrowMarker.setAttribute('refX', '9');
        arrowMarker.setAttribute('refY', '3.5');
        arrowMarker.setAttribute('orient', 'auto');
        
        const arrowPath = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
        arrowPath.setAttribute('points', '0 0, 10 3.5, 0 7');
        arrowPath.setAttribute('fill', '#f59e42');
        
        arrowMarker.appendChild(arrowPath);
        svg.appendChild(arrowMarker);
        
        // Add current flow line with arrow
        const currentFlow = document.createElementNS('http://www.w3.org/2000/svg', 'line');
        currentFlow.setAttribute('x1', xStart - 10);
        currentFlow.setAttribute('y1', yMain + 10);
        currentFlow.setAttribute('x2', xStart - 10);
        currentFlow.setAttribute('y2', yMain - 20);
        currentFlow.setAttribute('stroke', '#f59e42');
        currentFlow.setAttribute('stroke-width', '2');
        currentFlow.setAttribute('marker-end', 'url(#arrowhead)');
        svg.appendChild(currentFlow);
      } else {
        // Show voltage at battery
        const voltageLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
        voltageLabel.setAttribute('x', batteryX + 15);
        voltageLabel.setAttribute('y', yMain + 130);
        voltageLabel.setAttribute('class', 'svg-volt');
        voltageLabel.textContent = voltageValue ? voltageValue + ' V' : '? V';
        svg.appendChild(voltageLabel);
      }

      // Draw components
      for (let i = 0; i < resistors.length; i++) {
        const resistor = resistors[i];
        const x = xPositions[i];
        
        if (resistor.parallels.length > 0) {
          // Draw parallel circuit
          const nPar = resistor.parallels.length + 1;
          const splitX = x + 10; // Align with start
          const joinX = x + 10 + 160; // Align with end
          const parallelWidth = joinX - splitX;
          const resistorX = splitX + (parallelWidth - blockW) / 2; // Center resistor between split and join
          
          for (let j = 0; j < nPar; j++) {
            const yOffset = ((j - (nPar - 1) / 2) * parSpacing);
            const yBranch = yMain + yOffset;
            
            // Vertical wire before resistor
            const vWire1 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            vWire1.setAttribute('x1', splitX);
            vWire1.setAttribute('y1', yMain);
            vWire1.setAttribute('x2', splitX);
            vWire1.setAttribute('y2', yBranch);
            vWire1.setAttribute('class', 'svg-branch-wire');
            svg.appendChild(vWire1);

            // Horizontal wire before resistor
            const hWire1 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            hWire1.setAttribute('x1', splitX);
            hWire1.setAttribute('y1', yBranch);
            hWire1.setAttribute('x2', resistorX);
            hWire1.setAttribute('y2', yBranch);
            hWire1.setAttribute('class', 'svg-branch-wire');
            svg.appendChild(hWire1);
            
            // Resistor block
            const block = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            block.setAttribute('x', resistorX);
            block.setAttribute('y', yBranch - blockH/2);
            block.setAttribute('width', blockW);
            block.setAttribute('height', blockH);
            block.setAttribute('class', j === 0 ? 'svg-resistor' : 'svg-resistor-parallel');
            svg.appendChild(block);
            
            // Value label
            const value = j === 0 ? resistor.value : resistor.parallels[j-1].value;
            const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            label.setAttribute('x', resistorX + blockW/2);
            label.setAttribute('y', yBranch);
            label.setAttribute('class', 'svg-label');
            label.textContent = value;
            svg.appendChild(label);
            
            // Ohm symbol
            const ohm = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            ohm.setAttribute('x', resistorX + blockW/2);
            ohm.setAttribute('y', yBranch - blockH/2 - 10);
            ohm.setAttribute('class', 'svg-ohm');
            ohm.textContent = 'Ω';
            svg.appendChild(ohm);
            
            // Horizontal wire after resistor
            const hWire2 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            hWire2.setAttribute('x1', resistorX + blockW);
            hWire2.setAttribute('y1', yBranch);
            hWire2.setAttribute('x2', joinX);
            hWire2.setAttribute('y2', yBranch);
            hWire2.setAttribute('class', 'svg-branch-wire');
            svg.appendChild(hWire2);
            
            // Vertical wire after resistor
            const vWire2 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            vWire2.setAttribute('x1', joinX);
            vWire2.setAttribute('y1', yBranch);
            vWire2.setAttribute('x2', joinX);
            vWire2.setAttribute('y2', yMain);
            vWire2.setAttribute('class', 'svg-branch-wire');
            svg.appendChild(vWire2);
            
            // Add connection dots at resistor ends
            dotsToAdd.push({x: resistorX, y: yBranch}); // Left dot
            dotsToAdd.push({x: resistorX + blockW, y: yBranch}); // Right dot
          }
          
          // Add main wire connection dots
          dotsToAdd.push({x: splitX, y: yMain});
          dotsToAdd.push({x: joinX, y: yMain});
        } else {
          const resistorX = x + 10;
          // Draw single resistor
          const block = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
          block.setAttribute('x', resistorX);
          block.setAttribute('y', yMain - blockH/2);
          block.setAttribute('width', blockW);
          block.setAttribute('height', blockH);
          block.setAttribute('class', 'svg-resistor');
          svg.appendChild(block);
          
          // Value label
          const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
          label.setAttribute('x', resistorX + blockW/2);
          label.setAttribute('y', yMain);
          label.setAttribute('class', 'svg-label');
          label.textContent = resistor.value;
          svg.appendChild(label);
          
          // Ohm symbol
          const ohm = document.createElementNS('http://www.w3.org/2000/svg', 'text');
          ohm.setAttribute('x', resistorX + blockW/2);
          ohm.setAttribute('y', yMain - blockH/2 - 10);
          ohm.setAttribute('class', 'svg-ohm');
          ohm.textContent = 'Ω';
          svg.appendChild(ohm);

          // Add connection dots at resistor ends
          dotsToAdd.push({x: resistorX, y: yMain}); // Left dot
          dotsToAdd.push({x: resistorX + blockW, y: yMain}); // Right dot
        }
      }

      // Add all connection dots last (so they appear on top)
      dotsToAdd.forEach(dot => {
        const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
        circle.setAttribute('cx', dot.x);
        circle.setAttribute('cy', dot.y);
        circle.setAttribute('r', 4);
        circle.setAttribute('fill', '#000');
        circle.setAttribute('stroke', '#fff');
        circle.setAttribute('stroke-width', '1');
        svg.appendChild(circle);
      });

      diagramArea.appendChild(svg);
    }

    // Updated resistor management functions
    function createResistorInput(index, value, parallels) {
      const div = document.createElement('div');
      div.className = 'resistor-group border border-gray-200 rounded-lg p-4';
      
      let html = `
        <div class="flex items-center gap-4 mb-3">
          <div class="flex-1">
            <label class="block text-sm font-medium text-gray-700 mb-1">R${index + 1} Value (Ω)</label>
            <input type="number" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" 
                   value="${value}" onchange="updateResistorValue(${index}, this.value)">
          </div>
          <div class="flex flex-col gap-2">
            <button onclick="addParallelResistor(${index})" class="px-3 py-1.5 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors">
              + Add Parallel
            </button>
            ${index > 0 ? `
              <button onclick="removeResistor(${index})" class="px-3 py-1.5 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors">
                Remove
              </button>
            ` : ''}
          </div>
        </div>
      `;

      // Add parallel resistors if any
      if (parallels && parallels.length > 0) {
        html += '<div class="pl-6 border-l-2 border-green-200">';
        parallels.forEach((parallel, pIdx) => {
          html += `
            <div class="flex items-center gap-4 mt-3">
              <div class="flex-1">
                <label class="block text-sm font-medium text-gray-700 mb-1">R${index + 1}.${pIdx + 1} Parallel (Ω)</label>
                <input type="number" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" 
                       value="${parallel.value}" onchange="updateParallelValue(${index}, ${pIdx}, this.value)">
              </div>
              <button onclick="removeParallel(${index}, ${pIdx})" class="px-3 py-1.5 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors">
                Remove
              </button>
            </div>
          `;
        });
        html += '</div>';
      }

      div.innerHTML = html;
      return div;
    }

    function renderResistorSidebar() {
      const sidebar = document.getElementById('resistorSidebar');
      sidebar.innerHTML = '';
      resistors.forEach((resistor, index) => {
        sidebar.appendChild(createResistorInput(index, resistor.value, resistor.parallels));
      });
    }

    function addSeriesResistor() {
      resistors.push({ value: 10, parallels: [] });
      renderResistorSidebar();
      renderDiagram();
    }

    function addParallelResistor(index) {
      resistors[index].parallels.push({ value: 10 });
      renderResistorSidebar();
      renderDiagram();
    }

    function removeResistor(index) {
      if (index > 0) {  // Don't remove the first resistor
        resistors.splice(index, 1);
        renderResistorSidebar();
        renderDiagram();
      }
    }

    function removeParallel(resistorIndex, parallelIndex) {
      resistors[resistorIndex].parallels.splice(parallelIndex, 1);
      renderResistorSidebar();
      renderDiagram();
    }

    function updateResistorValue(index, value) {
      const numValue = parseFloat(value);
      if (!isNaN(numValue) && numValue > 0) {
        resistors[index].value = numValue;
        renderDiagram();
      }
    }

    function updateParallelValue(resistorIndex, parallelIndex, value) {
      const numValue = parseFloat(value);
      if (!isNaN(numValue) && numValue > 0) {
        resistors[resistorIndex].parallels[parallelIndex].value = numValue;
        renderDiagram();
      }
    }

    // --- Calculation Logic ---
    function calcParallel(parArr) {
      // Returns total resistance of parallel group
      let valid = parArr.filter(p => isValidNumber(p.value));
      if (valid.length === 0) return 0;
      let invSum = 0;
      for (let p of valid) {
        invSum += 1 / p.value;
      }
      return invSum > 0 ? 1 / invSum : 0;
    }

    function calcTotalResistance() {
      // Calculate total series resistance including parallel components
      return resistors.reduce((total, resistor) => {
        let groupResistance = resistor.value;
        if (resistor.parallels.length > 0) {
          // Calculate parallel resistance
          let reciprocalSum = 1/resistor.value;
          resistor.parallels.forEach(p => {
            reciprocalSum += 1/p.value;
          });
          groupResistance = 1/reciprocalSum;
        }
        return total + groupResistance;
      }, 0);
    }

    function calculateCircuitValues(voltage, current, totalR) {
      // Calculate current if voltage is given, or voltage if current is given
      const calculatedCurrent = voltage > 0 && totalR > 0 ? voltage / totalR : current;
      const calculatedVoltage = current > 0 && totalR > 0 ? current * totalR : voltage;
      
      return {
        current: calculatedCurrent,
        voltage: calculatedVoltage,
        resistance: totalR
      };
    }

    function generateAnalysisHTML(circuitValues) {
      let analysisHTML = '<div class="series-group-values">';
      
      // Show total voltage if current is given, or total current if voltage is given
      if (circuitValues.current > 0 && circuitValues.resistance > 0) {
        if (!voltage) {
          analysisHTML += `
            <div class="series-value">
              <div class="series-value-label" style="color: #f59e42; font-weight: 500">Total Circuit Voltage:</div>
              <div class="series-value-label" style="margin-left: 1rem">
                V = I × R = ${circuitValues.current.toFixed(3)} A × ${circuitValues.resistance.toFixed(2)} Ω = ${circuitValues.voltage.toFixed(2)} V
              </div>
            </div>
          `;
        }
      }

      // Show voltage distribution for each resistor
      analysisHTML += `
        <div class="series-value" style="margin-top: 1rem">
          <div class="series-value-label" style="color: #3b82f6; font-weight: 500">Voltage and Current Distribution:</div>
      `;

      // Calculate and show values for each resistor
      let seriesEquation = '';
      resistors.forEach((resistor, idx) => {
        const voltageAcross = circuitValues.current * resistor.value;
        analysisHTML += `
          <div class="series-value-label" style="margin-left: 1rem; margin-top: 0.5rem">
            R${idx + 1}: R = ${resistor.value} Ω V = ${voltageAcross.toFixed(2)} V I = ${circuitValues.current.toFixed(3)} A
          </div>
        `;
        seriesEquation += (idx > 0 ? ' + ' : '') + `${resistor.value}Ω`;
      });

      analysisHTML += `</div>`;
      
      // Show series sum
      analysisHTML += `
        <div class="series-value" style="margin-top: 1rem">
          <div class="series-value-label">Series sum: ${seriesEquation} = ${circuitValues.resistance.toFixed(2)} Ω</div>
        </div>
      `;
      
      // Show series combination
      analysisHTML += `
        <div class="series-value" style="margin-top: 1rem">
          <div class="series-value-label" style="color: #3b82f6; font-weight: 500">Series Combination:</div>
          <div class="series-value-label" style="margin-left: 1rem">
            Rtotal = ${resistors.map(r => r.value + ' Ω').join(' + ')} = ${circuitValues.resistance.toFixed(2)} Ω
          </div>
        </div>
      `;

      // Show total current calculation
      if (circuitValues.voltage > 0) {
        analysisHTML += `
          <div class="series-value" style="margin-top: 1rem">
            <div class="series-value-label">Total current: I = V/R = ${circuitValues.voltage}V / ${circuitValues.resistance.toFixed(2)}Ω = ${circuitValues.current.toFixed(3)} A</div>
          </div>
        `;
      }
      
      return analysisHTML;
    }



    // --- Results Rendering ---
    function renderResults() {
      // Total resistance
      const totalR = calcTotalResistance();
      totalResistanceDiv.innerHTML =
        isValidNumber(totalR)
          ? `Total Resistance: <span style="color:#4a90e2">${totalR.toFixed(2)} Ω</span>`
          : 'Total Resistance: <span style="color:#e57373">Invalid</span>';
      // Voltages/currents
      const totalV = parseFloat(totalVoltageInput.value);
      const totalI = parseFloat(totalCurrentInput.value);
      let breakdown = getResistorBreakdown(totalV, totalI, totalR);
      resistorDetailsDiv.innerHTML = '';
      let sCount = 1;
      let pCount = {};
      breakdown.forEach((item, i) => {
        const row = document.createElement('div');
        row.className = 'resistor-detail-row';
        if (item.isParallel) {
          // Parallel
          let parNum = pCount[item.parentIdx] = (pCount[item.parentIdx] || 0) + 1;
          row.innerHTML = `<span class="detail-label detail-parallel">P${item.parentIdx+1}.${parNum}</span>
            <span>R = ${isValidNumber(item.value) ? item.value + ' Ω' : '–'}</span>
            <span>V = ${isValidNumber(item.voltage) ? item.voltage.toFixed(2) + ' V' : '–'}</span>
            <span>I = ${isValidNumber(item.current) ? item.current.toFixed(3) + ' A' : '–'}</span>`;
        } else {
          // Series
          row.innerHTML = `<span class="detail-label">R${sCount}</span>
            <span>R = ${isValidNumber(item.value) ? item.value + ' Ω' : '–'}</span>
            <span>V = ${isValidNumber(item.voltage) ? item.voltage.toFixed(2) + ' V' : '–'}</span>
            <span>I = ${isValidNumber(item.current) ? item.current.toFixed(3) + ' A' : '–'}</span>`;
          sCount++;
        }
        resistorDetailsDiv.appendChild(row);
      });
      // Show total voltage if only current is given
      if (!isValidNumber(totalV) && isValidNumber(totalI) && isValidNumber(totalR)) {
        const vCalc = totalI * totalR;
        const vRow = document.createElement('div');
        vRow.className = 'text-lg font-semibold text-blue-700 my-2';
        vRow.innerHTML = `Total Voltage: <span style="color:#f59e42">V = I × R = ${totalI} × ${totalR.toFixed(2)} = ${vCalc.toFixed(2)} V</span>`;
        resistorDetailsDiv.prepend(vRow);
      }
    }

    // --- Calculate Button and Working Steps ---
    function calculateAndDisplay() {
      const voltage = parseFloat(document.getElementById('totalVoltageInput').value) || 0;
      const current = parseFloat(document.getElementById('totalCurrentInput').value) || 0;
      const totalR = calcTotalResistance();
      
      // Show results section
      document.getElementById('resultsSection').style.display = 'block';
      
      // Calculate circuit values
      const calculatedCurrent = voltage > 0 ? voltage / totalR : current;
      const calculatedVoltage = voltage > 0 ? voltage : current * totalR;
      
      // Update the display values
      document.getElementById('totalResistance').textContent = totalR.toFixed(2);
      document.getElementById('totalCurrent').textContent = calculatedCurrent.toFixed(3);
      
      // Update the analysis display
      const seriesGroupsContainer = document.getElementById('seriesGroups');
      seriesGroupsContainer.innerHTML = '';
      
      const seriesGroup = document.createElement('div');
      seriesGroup.className = 'series-group';
      
      let html = `
        <div class="series-value">
          <div class="series-value-label" style="color: #f59e42; font-weight: 500">Circuit Values:</div>
          <div class="series-value-label" style="margin-left: 1rem">
            Total Voltage: ${calculatedVoltage.toFixed(2)} V<br>
            Total Current: ${calculatedCurrent.toFixed(3)} A<br>
            Total Resistance: ${totalR.toFixed(2)} Ω
          </div>
        </div>

        <div class="series-value" style="margin-top: 1rem">
          <div class="series-value-label" style="color: #f59e42; font-weight: 500">Ohm's Law Calculation:</div>
          <div class="series-value-label" style="margin-left: 1rem">`;

      if (voltage > 0) {
        html += `Given V = ${voltage.toFixed(2)} V and RT = ${totalR.toFixed(2)} Ω<br>`;
        html += `I = V/RT = ${voltage.toFixed(2)}/${totalR.toFixed(2)} = ${calculatedCurrent.toFixed(3)} A`;
      } else if (current > 0) {
        html += `Given I = ${current.toFixed(3)} A and RT = ${totalR.toFixed(2)} Ω<br>`;
        html += `V = I × RT = ${current.toFixed(3)} × ${totalR.toFixed(2)} = ${calculatedVoltage.toFixed(2)} V`;
      }

      html += `</div>
        </div>`;

      // First calculate parallel groups
      let parallelGroups = [];
      resistors.forEach((resistor, idx) => {
        if (resistor.parallels.length > 0) {
          // Calculate parallel resistance
          let reciprocalSum = 1/resistor.value;
          resistor.parallels.forEach(p => {
            reciprocalSum += 1/p.value;
          });
          const rpParallel = 1/reciprocalSum;
          
          // Check if all resistors have the same value for simplified fraction
          const allValues = [resistor.value, ...resistor.parallels.map(p => p.value)];
          const allSameValue = allValues.every(v => v === allValues[0]);
          
          html += `
            <div class="series-value" style="margin-top: 1rem">
              <div class="series-value-label" style="color: #22c55e; font-weight: 500">Parallel Group ${idx + 1}:</div>
              <div class="series-value-label" style="margin-left: 1rem">
                1/Rp = 1/${resistor.value}`;
          
          resistor.parallels.forEach((p, pIdx) => {
            html += ` + 1/${p.value}`;
          });
          
          if (allSameValue) {
            // If all resistors have the same value, show simplified fraction
            const commonValue = allValues[0];
            const numResistors = allValues.length;
            html += ` = ${numResistors}/${commonValue}<br>`;
            html += `Rp${idx + 1} = ${commonValue}/${numResistors} = ${rpParallel.toFixed(2)} Ω`;
          } else {
            // If resistors have different values, show the decimal
            html += ` = ${reciprocalSum.toFixed(3)}<br>`;
            html += `Rp${idx + 1} = 1/(${reciprocalSum.toFixed(3)}) = ${rpParallel.toFixed(2)} Ω`;
          }
          
          html += `</div>
            </div>`;
          
          parallelGroups.push({
            index: idx,
            equivalent: rpParallel
          });
        }
      });
      
      // Then show series combination using the parallel equivalents
      html += `
        <div class="series-value" style="margin-top: 1rem">
          <div class="series-value-label" style="color: #3b82f6; font-weight: 500">Series Combination:</div>
          <div class="series-value-label" style="margin-left: 1rem">
            RT = `;
      
      // Build series equation using parallel equivalents where needed
      let seriesTerms = resistors.map((r, idx) => {
        const parallelGroup = parallelGroups.find(pg => pg.index === idx);
        if (parallelGroup) {
          return `Rp${idx + 1}`;
        }
        return `R${idx + 1}`;
      }).join(' + ');
      
      // Add the values
      html += seriesTerms + ' = ';
      
      seriesTerms = resistors.map((r, idx) => {
        const parallelGroup = parallelGroups.find(pg => pg.index === idx);
        if (parallelGroup) {
          return parallelGroup.equivalent.toFixed(2);
        }
        return r.value.toString();
      }).join(' + ');
      
      html += `${seriesTerms} = ${totalR.toFixed(2)} Ω
          </div>
        </div>
        
        <div class="series-value" style="margin-top: 1rem">
          <div class="series-value-label" style="color: #3b82f6; font-weight: 500">Step-by-Step Analysis:</div>
      `;
      
      // Calculate and show values for each resistor/parallel group
      resistors.forEach((resistor, idx) => {
        const parallelGroup = parallelGroups.find(pg => pg.index === idx);
        if (parallelGroup) {
          const groupVoltage = calculatedCurrent * parallelGroup.equivalent;
          html += `
            <div class="series-value-label" style="margin-left: 1rem; margin-top: 0.5rem">
              Parallel Group ${idx + 1}:<br>
              V = I × Rp = ${calculatedCurrent.toFixed(3)} × ${parallelGroup.equivalent.toFixed(2)} = ${groupVoltage.toFixed(2)} V<br>
              I = ${calculatedCurrent.toFixed(3)} A<br>
              Individual branch currents:<br>`;
          
          // Main resistor
          const mainCurrent = groupVoltage / resistor.value;
          html += `&nbsp;&nbsp;R${idx + 1}: I = V/R = ${groupVoltage.toFixed(2)}/${resistor.value} = ${mainCurrent.toFixed(3)} A<br>`;
          
          // Parallel resistors
          resistor.parallels.forEach((p, pIdx) => {
            const branchCurrent = groupVoltage / p.value;
            html += `&nbsp;&nbsp;R${idx + 1}.${pIdx + 1}: I = V/R = ${groupVoltage.toFixed(2)}/${p.value} = ${branchCurrent.toFixed(3)} A<br>`;
          });
          
          html += '</div>';
        } else {
          const voltageAcross = calculatedCurrent * resistor.value;
          html += `
            <div class="series-value-label" style="margin-left: 1rem; margin-top: 0.5rem">
              R${idx + 1}:<br>
              V = I × R = ${calculatedCurrent.toFixed(3)} × ${resistor.value} = ${voltageAcross.toFixed(2)} V<br>
              I = ${calculatedCurrent.toFixed(3)} A
            </div>
          `;
        }
      });
      
      html += '</div>';
      seriesGroup.innerHTML = html;
      seriesGroupsContainer.appendChild(seriesGroup);
      
      // Re-render diagram with updated values
      renderDiagram();
    }

    // --- Input Validation and Styling ---
    function updateInputStyles() {
      const voltageValue = totalVoltageInput.value.trim();
      const currentValue = totalCurrentInput.value.trim();
      
      // Add some visual styling to show which input is active/disabled
      if (voltageValue) {
        totalVoltageInput.classList.add('border-blue-500');
        totalCurrentInput.classList.add('bg-gray-100');
        totalCurrentInput.classList.add('cursor-not-allowed');
        totalCurrentInput.setAttribute('readonly', true);
        totalCurrentInput.value = '';
      } else if (currentValue) {
        totalCurrentInput.classList.add('border-blue-500');
        totalVoltageInput.classList.add('bg-gray-100');
        totalVoltageInput.classList.add('cursor-not-allowed');
        totalVoltageInput.setAttribute('readonly', true);
        totalVoltageInput.value = '';
      } else {
        // Reset styles when both are empty
        totalVoltageInput.classList.remove('border-blue-500', 'bg-gray-100', 'cursor-not-allowed');
        totalCurrentInput.classList.remove('border-blue-500', 'bg-gray-100', 'cursor-not-allowed');
        totalVoltageInput.removeAttribute('readonly');
        totalCurrentInput.removeAttribute('readonly');
      }
    }

    totalVoltageInput.addEventListener('input', updateInputStyles);
    totalCurrentInput.addEventListener('input', updateInputStyles);

    // Reset calculator function
    function resetCalculator() {
      // Reset inputs
      totalVoltageInput.value = '';
      totalCurrentInput.value = '';
      updateInputStyles();
      
      // Reset resistors to initial state
      resistors = [
        { value: 10, parallels: [] },
        { value: 10, parallels: [] }
      ];
      
      // Hide results
      document.getElementById('resultsSection').style.display = 'none';
      
      // Re-render everything
      renderResistorSidebar();
      renderDiagram();
    }

    // Initial setup
    updateInputStyles();

    // Initial render of resistors and diagram
    renderResistorSidebar();
    renderDiagram();
    renderDiagram();
    
    // Hide results area by default
    document.getElementById('resultsSection').style.display = 'none';

    // Initial render
    renderResistorSidebar();
  </script>
</body>
</html>